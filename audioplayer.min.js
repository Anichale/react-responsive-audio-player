!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("classnames")):"function"==typeof define&&define.amd?define(["react","classnames"],t):"object"==typeof exports?exports.AudioPlayer=t(require("react"),require("classnames")):e.AudioPlayer=t(e.React,e.classNames)}(this,function(e,t){return function(e){function t(s){if(i[s])return i[s].exports;var a=i[s]={exports:{},id:s,loaded:!1};return e[s].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){var t=Math.floor(e/60),i=(e%60).toFixed();return""+(10>t?"0":"")+t+":"+(10>i?"0":"")+i}var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=i(1),u=i(2),d=console.log.bind(console),c=console.error?console.error.bind(console):d,p=console.warn?console.warn.bind(console):d,h=function(e){function t(e){s(this,t);var i=a(this,Object.getPrototypeOf(t).call(this,e));return i.playlist=e.playlist,i.seekInProgress=!1,i.currentTrackIndex=0,i.state={activeTrackIndex:-1,paused:!0,displayedTime:0},i.audio=null,i.audioProgressContainer=null,i.audioProgressBoundingRect=null,i.seekReleaseListener=null,i.resizeListener=null,i}return n(t,e),r(t,[{key:"componentDidMount",value:function(){var e=this;i(3);var t=this.seekReleaseListener=this.seek.bind(this);window.addEventListener("mouseup",t),document.addEventListener("touchend",t);var s=this.resizeListener=this.fetchAudioProgressBoundingRect.bind(this);window.addEventListener("resize",s),s();var a=this.audio=document.createElement("audio");if(a.preload="metadata",a.addEventListener("ended",function(){var t=e.props.gapLengthInSeconds||0;setTimeout(e.skipToNextTrack.bind(e),1e3*t)}),a.addEventListener("timeupdate",this.handleTimeUpdate.bind(this)),a.addEventListener("loadedmetadata",function(){e.setState({activeTrackIndex:e.currentTrackIndex})}),a.addEventListener("play",function(){e.setState({paused:!1})}),a.addEventListener("stalled",this.togglePause.bind(this,!0)),this.playlist&&this.playlist.length&&(this.updateSource(),this.props.autoplay)){var n=this.props.autoplayDelayInSeconds||0;setTimeout(this.togglePause.bind(this,!1),1e3*n)}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mouseup",this.seekReleaseListener),document.removeEventListener("touchend",this.seekReleaseListener),window.removeEventListener("resize",this.resizeListener),this.audio.pause(),this.audio=null}},{key:"componentWillReceiveProps",value:function(e){e.playlist&&(this.playlist=e.playlist,this.currentTrackIndex=-1,this.audio&&this.skipToNextTrack(!1))}},{key:"togglePause",value:function(e){if(this.audio){var t="boolean"==typeof e?e:!this.state.paused;if(t)return this.audio.pause(),this.setState({paused:!0});if(this.playlist&&this.playlist.length)try{this.audio.play()}catch(i){c(i);var s="Audio playback failed at "+(new Date).toLocaleTimeString()+"! (Perhaps autoplay is disabled in this browser.)";p(s)}}}},{key:"skipToNextTrack",value:function(e){var t=this;if(this.audio&&(this.audio.pause(),this.playlist&&this.playlist.length)){var i=this.currentTrackIndex+1;i>=this.playlist.length&&(i=0),this.currentTrackIndex=i,this.setState({activeTrackIndex:-1,displayedTime:0},function(){t.updateSource();var i="boolean"==typeof e?!e:!1;t.togglePause(i)})}}},{key:"backSkip",value:function(){if(this.playlist&&this.playlist.length){var e=this.audio,t=this.props.stayOnBackSkipThreshold;if(isNaN(t)&&(t=5),e.currentTime>=t)return e.currentTime=0;var i=this.currentTrackIndex-1;0>i&&(i=this.playlist.length-1),this.currentTrackIndex=i-1,this.skipToNextTrack()}}},{key:"updateSource",value:function(){this.audio.src=this.playlist[this.currentTrackIndex].url}},{key:"fetchAudioProgressBoundingRect",value:function(){this.audioProgressBoundingRect=this.audioProgressContainer.getBoundingClientRect()}},{key:"handleTimeUpdate",value:function(){!this.seekInProgress&&this.audio&&this.setState({displayedTime:this.audio.currentTime})}},{key:"adjustDisplayedTime",value:function(e){if(this.playlist&&this.playlist.length){if("mousedown"===e.type||"touchstart"===e.type)this.seekInProgress=!0,document.body.classList.add("noselect");else if(!this.seekInProgress)return;e.preventDefault();var t=this.audioProgressBoundingRect,i="touch"===e.type.slice(0,5),s=i?e.targetTouches.item(0).pageX:e.pageX,a=s-t.left-document.body.scrollLeft,n=t.width,o=a/n;this.setState({displayedTime:o*this.audio.duration})}}},{key:"seek",value:function(e){if(document.body.classList.remove("noselect"),this.seekInProgress){e.preventDefault(),this.seekInProgress=!1;var t=this.state.displayedTime;isNaN(t)||(this.audio.currentTime=t)}}},{key:"render",value:function(){var e=this,t=this.state.activeTrackIndex,i=0>t?null:this.playlist[t].displayText,s=this.state.displayedTime,a=this.audio&&this.audio.duration||0,n=o(s),r=o(a),d=n+" / "+r,c=s/a*100+"%";return l.createElement("div",{id:"audio_player",className:u("audio_player",{top:this.props.placeAtTop}),title:i},l.createElement("div",{className:"audio_controls"},l.createElement("div",{id:"skip_button",className:u("skip_button","back","audio_button",{hidden:this.props.hideBackSkip}),onClick:this.backSkip.bind(this)},l.createElement("div",{className:"skip_button_inner"},l.createElement("div",{className:"right_facing_triangle"}),l.createElement("div",{className:"right_facing_triangle"}))),l.createElement("div",{id:"play_pause_button",className:u("play_pause_button","audio_button",{paused:this.state.paused}),onClick:this.togglePause.bind(this,null)},l.createElement("div",{className:"play_pause_inner"},l.createElement("div",{className:"left"}),l.createElement("div",{className:"right"}),l.createElement("div",{className:"triangle_1"}),l.createElement("div",{className:"triangle_2"}))),l.createElement("div",{id:"skip_button",className:"skip_button audio_button",onClick:this.skipToNextTrack.bind(this,null)},l.createElement("div",{className:"skip_button_inner"},l.createElement("div",{className:"right_facing_triangle"}),l.createElement("div",{className:"right_facing_triangle"})))),l.createElement("div",{id:"audio_progress_container",className:"audio_progress_container",ref:function(t){return e.audioProgressContainer=t},onMouseDown:this.adjustDisplayedTime.bind(this),onMouseMove:this.adjustDisplayedTime.bind(this),onTouchStart:this.adjustDisplayedTime.bind(this),onTouchMove:this.adjustDisplayedTime.bind(this)},l.createElement("div",{id:"audio_progress",className:"audio_progress",style:{width:c}}),l.createElement("div",{id:"audio_progress_overlay",className:"audio_progress_overlay"},l.createElement("div",{className:"audio_info_marquee"},l.createElement("div",{id:"audio_info",className:"audio_info noselect",draggable:"false"},i)),l.createElement("div",{id:"audio_time_progress",className:"audio_time_progress noselect",draggable:"false"},d))))}}]),t}(l.Component);h.propTypes={playlist:l.PropTypes.array,autoplay:l.PropTypes.bool,autoplayDelayInSeconds:l.PropTypes.number,gapLengthInSeconds:l.PropTypes.number,hideBackSkip:l.PropTypes.bool,stayOnBackSkipThreshold:l.PropTypes.number,placeAtTop:l.PropTypes.bool},e.exports=h},function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){}])});